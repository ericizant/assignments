<!DOCTYPE html>
<html>

<head>
    <title>Crypto Publisher</title>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.18.0.js"></script>
</head>

<body>
    <script type="text/javascript">
        var pubnub = new PubNub({
            publishKey: 'pub-c-07927f0c-fb68-4e54-8273-cba1a58114c4',
            subscribeKey: 'sub-c-6df1e16a-0ad8-11e8-a9dd-468c7af2c484'
        });

        var xhr = new XMLHttpRequest();

        function processRequest(e) {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                console.log(response);

                pubnub.publish({
                    channel: 'bitcoin-feed',
                    message: {
                        eon: {
                            'BitCoin': response.BTC.USD.toFixed(2)
                        }
                    }
                });

                pubnub.publish({
                    channel: 'ether-feed',
                    message: {
                        eon: {
                            'Ether': response.ETH.USD.toFixed(2)
                        }
                    }
                });

                pubnub.publish({
                    channel: 'litecoin-feed',
                    message: {
                        eon: {
                            'LiteCoin': response.LTC.USD.toFixed(2)
                        }
                    }
                });
            }
        }

        function mainApp() {
            setInterval(function () {
                xhr.open('GET', 'https://api.coinmarketcap.com/v1/ticker/',
                    true)
                xhr.send();
                xhr.onreadystatechange = processRequest;
            }, 10000)
        };
        mainApp();
    </script>
</body>

</html>